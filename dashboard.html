<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Edge Websites</title>
    <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
        }
        
        .header-nav {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-nav .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-nav .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #00ff88;
            text-decoration: none;
        }
        
        .header-nav .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .header-nav .home-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-nav .home-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.35);
        }
        
        .header-nav .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .header-nav .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 20px;
        }

        .dashboard-title {
            background: transparent;
        }

        .dashboard-title h1 {
            font-size: 2.75rem;
            font-weight: 800;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #00ff88;
            margin-bottom: 0.5rem;
        }

        .dashboard-title p {
            color: rgba(255, 255, 255, 0.75);
            max-width: 720px;
        }
        
        .welcome-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #1f1f1f 100%);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.15);
        }
        
        .welcome-section h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }
        
        .welcome-section .welcome-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .welcome-section .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .stat-item {
            background: rgba(0, 255, 136, 0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }
        
        .stat-value {
            color: #00ff88;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .stat-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-top: 0.35rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: #1a1a1a;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 255, 136, 0.25);
        }
        
        .dashboard-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-icon {
            font-size: 1.5rem;
        }
        
        .dashboard-card .status {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .status.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .status.cancelled {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
        }
        
        .status.pending {
            background: rgba(255, 200, 0, 0.2);
            color: #ffc800;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .info-value {
            color: #ffffff;
            font-weight: 600;
            font-size: 1rem;
            text-align: right;
        }
        
        .btn {
            display: inline-block;
            width: 100%;
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000000;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #00cc6a, #00ff88);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .btn-danger {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .action-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }
        
        .action-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .action-list li:last-child {
            border-bottom: none;
        }
        
        .action-list a {
            color: #00ff88;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s ease;
        }
        
        .action-list a:hover {
            color: #00cc6a;
        }
        
        .status-chip {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.06em;
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            text-transform: uppercase;
        }
        
        .status-chip.trial {
            background: rgba(0, 123, 255, 0.2);
            color: #4dabff;
        }
        
        .status-chip.paused {
            background: rgba(255, 191, 0, 0.2);
            color: #ffc857;
        }
        
        .pricing-line {
            font-size: 2.4rem;
            font-weight: 800;
            margin: 0.75rem 0;
        }
        
        .pricing-line span {
            font-size: 0.95rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.65);
            margin-left: 0.3rem;
        }
        
        .muted {
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .card-divider {
            height: 1px;
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            margin: 1.2rem 0;
        }
        
        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .info-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }
        
        .info-list li:last-child {
            border-bottom: none;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .progress-track {
            margin: 0.75rem 0 1rem;
            height: 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            transition: width 0.4s ease;
        }
        
        .assets-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .asset-tag {
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            background: rgba(0, 255, 136, 0.13);
            color: #00ff88;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0;
        }
        
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            text-decoration: none;
            color: inherit;
            transition: background 0.2s ease;
            border-radius: 10px;
            padding-right: 0.75rem;
        }
        
        .checklist-item:hover {
            background: rgba(0, 255, 136, 0.08);
        }
        
        .checklist-item:last-child {
            border-bottom: none;
        }
        
        .checklist-item .icon {
            font-size: 1.1rem;
            margin-top: 0.1rem;
            color: #00ff88;
        }
        
        .checklist-item.pending .icon {
            color: rgba(255, 255, 255, 0.35);
        }
        
        .checklist-item strong {
            font-size: 1rem;
        }
        
        .task-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.9rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .task-item.done {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
        }
        
        .task-checkbox {
            width: 18px;
            height: 18px;
            margin-top: 0.2rem;
        }
        
        .task-content strong {
            display: block;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .task-content span {
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.9rem;
        }
        
        .tag {
            margin-left: auto;
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            padding: 0.3rem 0.65rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .task-form {
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
            margin-top: 1rem;
        }
        
        .task-form label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        .task-form input,
        .task-form textarea,
        .task-form select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(10, 10, 10, 0.85);
            color: #fff;
            font-family: inherit;
            font-size: 0.95rem;
        }
        
        .task-form textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .task-form button {
            align-self: flex-start;
            padding: 0.7rem 1.6rem;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .task-form button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }
        
        .task-form small {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .form-success {
            margin-top: 0.75rem;
            color: #00ff88;
            font-size: 0.9rem;
            font-weight: 600;
            display: none;
        }

        .scheduler-shell {
            position: relative;
            border-radius: 18px;
            padding: 1.8rem;
            background: radial-gradient(circle at 15% -20%, rgba(0, 255, 136, 0.35), rgba(10, 10, 10, 0.95) 50%);
            border: 1px solid rgba(0, 255, 136, 0.35);
            box-shadow: 0 20px 55px rgba(0, 255, 136, 0.2);
        }

        .scheduler-shell::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(140deg, rgba(0, 255, 136, 0.22), rgba(0, 255, 136, 0));
            pointer-events: none;
        }

        .scheduler-preamble {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .scheduler-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            background: rgba(0, 255, 136, 0.12);
            border: 1px solid rgba(0, 255, 136, 0.38);
            color: #00ff88;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .scheduler-shell .microcopy {
            opacity: 0.65;
            font-size: 0.85rem;
        }

        .scheduler-body {
            display: grid;
            gap: 1.5rem;
        }

        .scheduler-calendar {
            border-radius: 16px;
            background: rgba(6, 16, 12, 0.95);
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: inset 0 0 0 1px rgba(0, 255, 136, 0.08);
            padding: 1.25rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-month {
            font-size: 1.15rem;
            font-weight: 700;
            letter-spacing: 0.06em;
        }

        .calendar-nav {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 1px solid rgba(0, 255, 136, 0.35);
            background: rgba(0, 255, 136, 0.12);
            color: #00ff88;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-nav:hover:not(:disabled) {
            transform: translateY(-2px);
            background: rgba(0, 255, 136, 0.22);
        }

        .calendar-nav:disabled {
            opacity: 0.35;
            cursor: not-allowed;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            text-align: center;
            text-transform: uppercase;
            font-size: 0.68rem;
            letter-spacing: 0.12em;
            color: rgba(255, 255, 255, 0.55);
            margin-bottom: 0.6rem;
        }

        .calendar-weekdays span {
            padding: 0.35rem 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 0.45rem;
        }

        .calendar-day {
            border-radius: 14px;
            padding: 0.75rem 0.45rem;
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #ffffff;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.18s ease;
        }

        .calendar-day .day-number {
            font-size: 1rem;
        }

        .calendar-day .day-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00ff88;
            margin-top: 0.32rem;
            opacity: 0;
        }

        .calendar-day.available .day-dot {
            opacity: 1;
        }

        .calendar-day.available:hover {
            transform: translateY(-3px);
            border-color: rgba(0, 255, 136, 0.55);
            box-shadow: 0 10px 18px rgba(0, 255, 136, 0.2);
        }

        .calendar-day.selected {
            background: linear-gradient(150deg, rgba(0, 255, 136, 0.28), rgba(0, 255, 136, 0.08));
            border-color: rgba(0, 255, 136, 0.75);
            color: #06150f;
            box-shadow: 0 16px 28px rgba(0, 255, 136, 0.32);
        }

        .calendar-day.unavailable {
            color: rgba(255, 255, 255, 0.28);
            border-style: dashed;
            cursor: not-allowed;
        }

        .calendar-day.placeholder {
            visibility: hidden;
            pointer-events: none;
        }

        .scheduler-slots {
            background: rgba(5, 14, 10, 0.92);
            border-radius: 16px;
            padding: 1.3rem;
            border: 1px solid rgba(0, 255, 136, 0.28);
            box-shadow: inset 0 0 0 1px rgba(0, 255, 136, 0.12);
        }

        .slots-heading {
            text-transform: uppercase;
            letter-spacing: 0.14em;
            font-size: 0.75rem;
            color: rgba(196, 255, 234, 0.85);
        }

        .slots-summary {
            margin-top: 0.4rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.68);
            font-size: 0.95rem;
        }

        .slots-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.55rem;
        }

        .slot-chip {
            padding: 0.55rem 1.05rem;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 136, 0.38);
            background: rgba(0, 255, 136, 0.12);
            color: #00ff88;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slot-chip:hover {
            background: rgba(0, 255, 136, 0.22);
            transform: translateY(-2px);
        }

        .slot-chip.selected {
            background: linear-gradient(140deg, #00ff88, #00cc6a);
            color: #03150e;
            border-color: transparent;
            box-shadow: 0 10px 22px rgba(0, 255, 136, 0.35);
        }

        .scheduler-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.3rem;
            align-items: flex-start;
        }

        .scheduler-note {
            font-size: 0.82rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .scheduler-followup {
            margin-top: 1.3rem;
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        .scheduler-followup .btn {
            flex: 1 1 220px;
        }


        .calendly-pill {
            background: rgba(0, 255, 136, 0.12);
            color: #00ff88;
            border-radius: 999px;
            padding: 0.35rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            align-self: flex-start;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        @keyframes pulseHighlight {
            0% {
                box-shadow: 0 0 0 rgba(0, 255, 136, 0);
            }
            30% {
                box-shadow: 0 0 0 12px rgba(0, 255, 136, 0.25);
            }
            60% {
                box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.15);
            }
            100% {
                box-shadow: 0 0 0 rgba(0, 255, 136, 0);
            }
        }

        .highlight-pulse {
            animation: pulseHighlight 1.5s ease;
        }
        
        .activity-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .activity-item {
            border-left: 2px solid rgba(0, 255, 136, 0.4);
            padding-left: 1rem;
        }
        
        .activity-item strong {
            display: block;
            font-size: 1rem;
        }
        
        .activity-item .time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        .activity-item p {
            margin-top: 0.25rem;
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.9rem;
        }
        
        .resource-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .resource-list a {
            display: block;
            padding: 0.9rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            text-decoration: none;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        
        .resource-list a:hover {
            transform: translateY(-2px);
            border-color: rgba(0, 255, 136, 0.35);
        }
        
        .resource-list span {
            display: block;
            margin-top: 0.35rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .support-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #00ff88;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .support-status.offline {
            color: #ff6b6b;
        }
        
        .support-actions {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            margin-top: 1rem;
        }
        
        .button-row {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            margin-top: 1.2rem;
        }
        
        .section-subheading {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.55);
            font-weight: 700;
        }
        
        @media (max-width: 768px) {
            .task-item {
                flex-direction: column;
            }
            
            .tag {
                margin-left: 0;
                margin-top: 0.5rem;
                align-self: flex-start;
            }
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }
        
        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .feature-badge {
            display: inline-block;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .welcome-section h1 {
                font-size: 2rem;
            }
            
            .welcome-section .quick-stats {
                grid-template-columns: 1fr;
            }

            .scheduler-shell {
                padding: 1.2rem;
            }

            .calendar-grid {
                gap: 0.35rem;
            }

            .calendar-day {
                padding: 0.6rem 0.3rem;
            }

            .slots-list {
                flex-direction: column;
            }

            .scheduler-followup {
                flex-direction: column;
            }

            .scheduler-followup .btn {
                width: 100%;
            }

        }
    </style>
</head>
<body>
    <nav class="header-nav">
        <div class="container">
            <a href="/" class="logo">EDGE WEBSITES</a>
            <div class="nav-links">
                <a href="/" class="home-btn">‚Üê Home</a>
                <a href="#" class="logout-btn" id="logoutBtn">Logout</a>
            </div>
        </div>
    </nav>

    <header class="dashboard-title">
        <div class="container">
            <h1>Dashboard</h1>
            <p>Track your build, complete tasks, and keep everything moving toward launch.</p>
        </div>
    </header>

    <div class="container">
        <div id="errorContainer"></div>
        
        <div id="welcomeSection" class="welcome-section" style="display: none;">
            <h1 id="welcomeTitle">Welcome back!</h1>
            <p class="welcome-text" id="welcomeText">Loading your account...</p>
            <div class="quick-stats" id="quickStats"></div>
        </div>

        <div id="dashboardContent" class="loading">Loading your account...</div>
    </div>

    <script>
        const customerEmail = sessionStorage.getItem('customerEmail');
        const customerId = sessionStorage.getItem('customerId');

        if (!customerEmail) {
            window.location.href = '/login.html';
        }

        function formatDate(isoString) {
            if (!isoString) return '‚Äî';
            const date = new Date(isoString);
            if (Number.isNaN(date.getTime())) return '‚Äî';
            return date.toLocaleDateString();
        }

        async function loadDashboard() {
            try {
                const payload = { email: customerEmail };
                if (customerId) {
                    payload.customerId = customerId;
                }

                const response = await fetch('/api/dashboard', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load dashboard');
                }

                displayDashboard(data);
            } catch (error) {
                document.getElementById('errorContainer').innerHTML = `<div class="error-message">${error.message}</div>`;
                document.getElementById('dashboardContent').innerHTML = '';
            }
        }

        function displayDashboard(data) {
            const { account, billing, website, onboarding, activity, resources, support } = data;

            const welcomeSection = document.getElementById('welcomeSection');
            const welcomeTitle = document.getElementById('welcomeTitle');
            const welcomeText = document.getElementById('welcomeText');
            const quickStats = document.getElementById('quickStats');
            
            const firstNameToken = (account?.email || '').split('@')[0].split(/[._-]/)[0] || 'there';
            const capitalizedName = firstNameToken.charAt(0).toUpperCase() + firstNameToken.slice(1);

            const hasPlan = !!account.plan.hasSelectedPlan;
            
            welcomeTitle.textContent = `Welcome back, ${capitalizedName}!`;
            welcomeText.textContent = hasPlan
                ? `You're on the ${account.plan.name}. Here's what's happening today.`
                : `You're in your free trial. No plan selected yet‚Äîchoose one whenever you're ready.`;

            const billingInterval = hasPlan ? (billing.interval || 'per month').replace('per ', '') : 'month';
            const planStatusCopy = !hasPlan
                ? 'No plan on file. Pick Basic or Pro whenever you‚Äôre ready‚Äîno payment required during trial.'
                : account.plan.status === 'trial'
                    ? `${account.plan.trialDaysRemaining} days left in your free trial. Billing starts after ${formatDate(account.plan.trialEndsAt)}.`
                    : account.plan.status === 'active'
                        ? 'Auto-renew is enabled'
                        : 'Plan currently paused';

            const pricingCaption = hasPlan
                ? (account.plan.status === 'trial' ? 'per month after trial' : (billing.interval || 'per month'))
                : 'Choose a plan when you‚Äôre ready';

            quickStats.innerHTML = `
                <div class="stat-item">
                    <div class="stat-label">Current Plan</div>
                    <div class="stat-value">${hasPlan ? `$${billing.amount}/${billingInterval}` : 'No plan selected'}</div>
                    <div class="stat-subtitle">${planStatusCopy}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Build Progress</div>
                    <div class="stat-value"><span id="buildProgressPercent">${website.progress}%</span></div>
                    <div class="stat-subtitle" id="buildStatusText">${website.status}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Next Milestone</div>
                    <div class="stat-value" style="font-size: 1.1rem;">${website.nextMilestone}</div>
                    <div class="stat-subtitle">${website.estimatedLaunch}</div>
                </div>
            `;
            
            welcomeSection.style.display = 'block';

            const content = document.getElementById('dashboardContent');
            content.className = 'dashboard-grid';

            const planStatusClass = account.plan.status === 'active'
                ? 'active'
                : account.plan.status === 'trial'
                    ? 'trial'
                    : 'paused';

            const checklistStateKey = `websiteChecklistState:${account.email}`;
            const storedChecklistState = JSON.parse(localStorage.getItem(checklistStateKey) || '{}');

            const checklistMarkup = (website.checklist || []).map(item => {
                const href = item.link || `mailto:${support.email}?subject=${encodeURIComponent(item.label)}`;
                const target = href.startsWith('/') || href.startsWith('#') ? '_self' : '_blank';
                const derivedState = item.status ? 'complete' : 'pending';
                const state = storedChecklistState[item.id] || derivedState;
                const statusLabel = state === 'complete' ? 'Completed' : state === 'in-progress' ? 'In progress' : 'Not started';
                return `
                    <a class="checklist-item ${item.status ? 'complete' : 'pending'} state-${state}" data-task-id="${item.id}" href="${href}" target="${target}" rel="noopener">
                        <span class="icon">${item.status ? '‚úÖ' : '‚è≥'}</span>
                        <div>
                            <strong>${item.label}</strong>
                            <span class="item-status">${statusLabel}</span>
                        </div>
                    </a>
                `;
            }).join('');

            const assetsMarkup = (website.assetsNeeded || []).map(asset => `
                <span class="asset-tag">${asset}</span>
            `).join('');

            const activityMarkup = (activity || []).map(item => `
                <li class="activity-item">
                    <strong>${item.title}</strong>
                    <span class="time">${item.timestamp}</span>
                    <p>${item.detail}</p>
                </li>
            `).join('');

            const resourcesMarkup = (resources || []).map(link => `
                <li><a href="${link.href}" target="_blank">${link.title}<span>${link.description}</span></a></li>
            `).join('');

            const memberSince = formatDate(account.createdAt);
            const trialEndDisplay = account.plan.trialDaysRemaining > 0
                ? formatDate(account.plan.trialEndsAt)
                : 'Trial completed';
            const nextInvoiceDisplay = hasPlan
                ? (billing.nextInvoice ? formatDate(billing.nextInvoice) : (account.plan.status === 'trial' ? 'After trial' : 'Pending'))
                : 'Not scheduled';

            const autopayDisplay = !hasPlan
                ? 'Not set (no plan yet)'
                : account.plan.status === 'trial'
                    ? 'Starts after trial'
                    : (billing.autopay ? 'Enabled' : 'Disabled');

            const pricingLineHTML = hasPlan
                ? `<p class="pricing-line">$${billing.amount}<span>${pricingCaption}</span></p>`
                : `<p class="pricing-line">No plan selected<span>${pricingCaption}</span></p>`;

            const planInfoListHTML = `
                <li><span class="info-label">Plan level</span><span class="info-value">${hasPlan ? account.plan.name : 'Not selected yet'}</span></li>
                <li><span class="info-label">Billing cadence</span><span class="info-value">${hasPlan ? (billing.interval || 'per month') : '‚Äî'}</span></li>
                <li><span class="info-label">Trial ends</span><span class="info-value">${trialEndDisplay}</span></li>
                <li><span class="info-label">Next invoice</span><span class="info-value">${nextInvoiceDisplay}</span></li>
                <li><span class="info-label">Autopay</span><span class="info-value">${autopayDisplay}</span></li>
            `;

            const planButtonRowHTML = hasPlan
                ? `<a class="btn btn-secondary" href="mailto:145brice@gmail.com?subject=Upgrade%20My%20Plan">Request plan change</a>
                   <a class="btn btn-secondary" href="mailto:145brice@gmail.com?subject=Pause%20My%20Subscription">Pause or cancel plan</a>`
                : `<a class="btn" href="/#pricing">Select a plan</a>
                   <a class="btn btn-secondary" href="mailto:145brice@gmail.com?subject=Help%20Choosing%20a%20Plan">Talk with us about options</a>`;

            content.innerHTML = `
                <div class="dashboard-card plan-card">
                    <h2><span class="card-icon">üè∑Ô∏è</span>Your Plan</h2>
                    <span class="status-chip ${planStatusClass}">${account.plan.status.toUpperCase()}</span>
                    ${pricingLineHTML}
                    <p class="muted">${planStatusCopy}</p>
                    <div class="card-divider"></div>
                    <ul class="info-list">
                        ${planInfoListHTML}
                    </ul>
                    <div class="button-row">
                        ${planButtonRowHTML}
                    </div>
                    </div>
                <div class="dashboard-card website-card">
                    <h2><span class="card-icon">üöÄ</span>Website Build Status</h2>
                    <div class="progress-label"><span id="websiteStatusLabel">${website.status}</span><span id="websiteProgressLabel">${website.progress}%</span></div>
                    <div class="progress-track"><div class="progress-fill" id="websiteProgressFill"></div></div>
                    <p class="muted">Next milestone: <strong>${website.nextMilestone}</strong></p>
                    <div class="card-divider"></div>
                    <h3 class="section-subheading">Build checklist</h3>
                    <div class="checklist">${checklistMarkup || '<div class="muted">No build tasks yet.</div>'}</div>
                    <div class="card-divider"></div>
                    <h3 class="section-subheading">Assets we still need</h3>
                    <div class="assets-list">${assetsMarkup || '<span class="muted">Nothing pending right now.</span>'}</div>
                    </div>
                <div class="dashboard-card onboarding-card">
                    <h2><span class="card-icon">‚úÖ</span>Onboarding Checklist</h2>
                    <p class="muted">${onboarding?.notes || 'Complete these steps to keep your launch on schedule.'}</p>
                    <div class="progress-label"><span>Checklist progress</span><span id="taskProgressPercent">0%</span></div>
                    <div class="progress-track"><div class="progress-fill" id="taskProgressFill"></div></div>
                    <p class="muted" id="taskProgressValue"></p>
                    <ul class="task-list" id="taskList"></ul>
                </div>
                <div class="dashboard-card activity-card">
                    <h2><span class="card-icon">üóìÔ∏è</span>Recent Activity</h2>
                    <ul class="activity-list" id="activityList">${activityMarkup || '<li class="muted">No activity yet.</li>'}</ul>
                    </div>
                <div class="dashboard-card resources-card">
                    <h2><span class="card-icon">üìö</span>Resource Library</h2>
                    <ul class="resource-list" id="resourceList">${resourcesMarkup || '<li class="muted">Resources coming soon.</li>'}</ul>
                    </div>
                <div class="dashboard-card support-card">
                    <h2><span class="card-icon">üí¨</span>Support</h2>
                    <div class="support-status ${support.status?.toLowerCase() === 'online' ? '' : 'offline'}">
                        <span>‚óè</span>
                        <span>${support.status || 'Online'}</span>
                </div>
                    <p class="muted" style="margin-top: 0.75rem;">Response time: ${support.responseTime || 'Under 24 hours'}</p>
                    <ul class="info-list" style="margin-top: 1rem;">
                        <li><span class="info-label">Email</span><span class="info-value">${support.email}</span></li>
                        ${support.phone ? `<li><span class="info-label">Phone</span><span class="info-value">${support.phone}</span></li>` : ''}
                    </ul>
                    <div class="support-actions">
                        <a class="btn btn-secondary" href="mailto:${support.email}?subject=Technical%20Support">Request technical help</a>
                        <a class="btn btn-secondary" href="mailto:${support.email}?subject=Content%20Update">Request content changes</a>
                </div>
                    </div>
                <div class="dashboard-card account-card">
                    <h2><span class="card-icon">üë§</span>Account &amp; Tools</h2>
                    <ul class="info-list">
                        <li><span class="info-label">Email</span><span class="info-value">${account.email}</span></li>
                        <li><span class="info-label">Member since</span><span class="info-value">${memberSince}</span></li>
                        <li><span class="info-label">Plan tier</span><span class="info-value">${hasPlan ? account.plan.tier : 'Trial access'}</span></li>
                        ${account.customerId ? `<li><span class="info-label">Account ID</span><span class="info-value">${account.customerId}</span></li>` : ''}
                    </ul>
                    <div class="button-row">
                        <a class="btn btn-secondary" href="/forgot-password.html">Reset password</a>
                        <a class="btn btn-secondary" href="mailto:${support.email}?subject=New%20Feature%20Request">Request a new feature</a>
                </div>
                </div>
            `;

            const taskForms = `
                <div class="dashboard-card" id="upload-assets">
                    <h2><span class="card-icon">üìÅ</span>Upload Brand Assets</h2>
                    <p class="muted">Share links to your logo, photography, brand guide, or any must-use media.</p>
                    <form class="task-form" data-task-id="upload-assets" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Upload brand assets">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Asset folder or sharing link
                            <input type="url" name="assetLink" placeholder="https://drive.google.com/..." required>
                        </label>
                        <label>Additional notes
                            <textarea name="notes" placeholder="Anything we should know about usage, brand colors, or fonts?"></textarea>
                        </label>
                        <small>Need to email files directly? Send them to 145brice@gmail.com.</small>
                        <button type="submit">Send assets</button>
                        <p class="form-success" data-message="Assets received! We'll start designing right away."></p>
                    </form>
                    </div>
                <div class="dashboard-card" id="business-questionnaire">
                    <h2><span class="card-icon">üß†</span>Business Questionnaire</h2>
                    <p class="muted">Answer a few quick questions so we can dial in your positioning and offers.</p>
                    <form class="task-form" data-task-id="complete-questionnaire" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Business questionnaire">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Your business name
                            <input type="text" name="businessName" required placeholder="Edge Bakery Co.">
                        </label>
                        <label>What do you sell?
                            <textarea name="coreOffer" required placeholder="Cupcakes, celebration cakes, walk-in bakery items..."></textarea>
                        </label>
                        <label>Top goal for this website
                            <select name="primaryGoal" required>
                                <option value="">Choose one...</option>
                                <option value="book-more-jobs">Book more jobs</option>
                                <option value="sell-products-online">Sell products online</option>
                                <option value="showcase-portfolio">Showcase portfolio</option>
                                <option value="improve-branding">Improve branding</option>
                            </select>
                        </label>
                        <label>Anything else we should know?
                            <textarea name="notes" placeholder="Special offers, differentiators, tone, etc."></textarea>
                        </label>
                        <button type="submit">Submit questionnaire</button>
                        <p class="form-success" data-message="Questionnaire submitted! We'll use this to guide your build."></p>
                    </form>
                </div>
                <div class="dashboard-card" id="schedule-kickoff">
                    <h2><span class="card-icon">üìÖ</span>Schedule Kickoff Call</h2>
                    <p class="muted">Pick a day, choose a time, and we‚Äôll lock in your 15-minute kickoff session.</p>
                    <div class="scheduler-shell">
                        <div class="scheduler-preamble">
                            <span class="scheduler-badge">Live scheduling</span>
                            <span class="microcopy">Green dates have open slots. We‚Äôll confirm with a calendar invite.</span>
                        </div>
                        <div class="scheduler-body">
                            <div class="scheduler-calendar">
                                <div class="calendar-header">
                                    <button type="button" class="calendar-nav" data-calendar-prev aria-label="Previous month">‚Äπ</button>
                                    <div class="calendar-month" data-calendar-month>Loading‚Ä¶</div>
                                    <button type="button" class="calendar-nav" data-calendar-next aria-label="Next month">‚Ä∫</button>
                                </div>
                                <div class="calendar-weekdays">
                                    <span>Sun</span>
                                    <span>Mon</span>
                                    <span>Tue</span>
                                    <span>Wed</span>
                                    <span>Thu</span>
                                    <span>Fri</span>
                                    <span>Sat</span>
                                </div>
                                <div class="calendar-grid" data-calendar-grid></div>
                            </div>
                            <div class="scheduler-slots">
                                <div class="slots-heading">Available times</div>
                                <div class="slots-summary" data-slot-summary>Select a day to view openings.</div>
                                <div class="slots-list" data-slot-list></div>
                                <form class="scheduler-actions" id="scheduleRequestForm" action="https://formspree.io/f/xpzqkqkq" method="POST">
                                    <input type="hidden" name="task" value="Kickoff scheduling request">
                                    <input type="hidden" name="customerEmail" value="${account.email}">
                                    <input type="hidden" name="scheduledDate" id="scheduledDateInput">
                                    <input type="hidden" name="scheduledTime" id="scheduledTimeInput">
                                    <button type="submit" class="btn" data-slot-confirm disabled>Confirm selected time</button>
                                    <span class="scheduler-note">We‚Äôll email a calendar invite within the hour.</span>
                                    <p class="form-success" id="scheduleSuccessMessage" data-message="Kickoff slot received! We‚Äôll confirm shortly."></p>
                                </form>
                            </div>
                        </div>
                        <div class="scheduler-followup">
                            <button type="button" class="btn btn-secondary mark-progress" data-task-id="book-kickoff" data-state="in-progress">I'll decide later</button>
                            <button type="button" class="btn mark-complete" data-task-id="book-kickoff">Kickoff already booked</button>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card" id="connect-domain">
                    <h2><span class="card-icon">üåê</span>Connect Your Domain</h2>
                    <p class="muted">Send us access so we can point your custom domain at your new Edge site.</p>
                    <ol class="muted" style="margin: 1rem 0 1.5rem 1.5rem; display: grid; gap: 0.75rem;">
                        <li>Log in to your domain registrar (GoDaddy, Namecheap, Google Domains, etc.).</li>
                        <li>Add support@edgewebsites.com (or share temporary access) so we can update DNS settings.</li>
                        <li>Let us know the domain you want live and any subdomains we should keep.</li>
                    </ol>
                    <form class="task-form" data-task-id="connect-domain" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Domain access details">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Registrar (where you bought the domain)
                            <input type="text" name="registrar" placeholder="GoDaddy" required>
                        </label>
                        <label>Login or collaborator email we can use
                            <input type="email" name="accessEmail" placeholder="support@edgewebsites.com" required>
                        </label>
                        <label>Domain(s) to launch
                            <input type="text" name="domain" placeholder="edgebakery.com" required>
                        </label>
                        <label>Notes or special instructions
                            <textarea name="domainNotes" placeholder="Keep blog.edgebakery.com on Squarespace..."></textarea>
                        </label>
                        <button type="submit">Send domain details</button>
                        <p class="form-success" data-message="Domain instructions received."></p>
                    </form>
                    <div class="button-row" style="margin-top: 1rem;">
                        <button type="button" class="btn mark-complete" data-task-id="connect-domain">Domain is connected</button>
                </div>
                    </div>
                <div class="dashboard-card" id="homepage-review">
                    <h2><span class="card-icon">üìù</span>Homepage Feedback</h2>
                    <p class="muted">Drop feedback for your first homepage draft‚Äîwhat you love, what you'd tweak.</p>
                    <form class="task-form" data-task-id="review-homepage" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Homepage review feedback">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Headline or hero feedback
                            <textarea name="headlineFeedback" placeholder="Headline feels great, maybe swap the second sentence..."></textarea>
                        </label>
                        <label>Sections to adjust
                            <textarea name="sectionChanges" placeholder="Hero CTA button text, gallery order, etc."></textarea>
                        </label>
                        <small>We'll confirm updates within 24 hours.</small>
                        <button type="submit">Submit homepage notes</button>
                        <p class="form-success" data-message="Homepage feedback sent!"></p>
                    </form>
                    </div>
                <div class="dashboard-card" id="copy-approval">
                    <h2><span class="card-icon">‚úçÔ∏è</span>Copy Approval</h2>
                    <p class="muted">Approve or revise the copy we've drafted‚Äîheadlines, blurbs, calls-to-action.</p>
                    <form class="task-form" data-task-id="copy-approval" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Copy approval">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Approval status
                            <select name="approvalStatus" required>
                                <option value="">Choose one...</option>
                                <option value="approved">Looks good ‚Äì ship it!</option>
                                <option value="needs-edits">Needs edits</option>
                            </select>
                        </label>
                        <label>Notes or edits
                            <textarea name="copyNotes" placeholder="If edits needed, list them here."></textarea>
                        </label>
                        <button type="submit">Send copy response</button>
                        <p class="form-success" data-message="Copy response received."></p>
                    </form>
                    </div>
                <div class="dashboard-card" id="mobile-polish">
                    <h2><span class="card-icon">üì±</span>Mobile Polish Checklist</h2>
                    <p class="muted">Give mobile view a final pass. Let us know if anything feels off on phones/tablets.</p>
                    <form class="task-form" data-task-id="mobile-polish" action="https://formspree.io/f/xpzqkqkq" method="POST">
                        <input type="hidden" name="task" value="Mobile polish feedback">
                        <input type="hidden" name="customerEmail" value="${account.email}">
                        <label>Device tested on
                            <input type="text" name="device" placeholder="iPhone 14, Galaxy S22, iPad Mini, etc." required>
                        </label>
                        <label>Anything to polish?
                            <textarea name="mobileIssues" placeholder="Buttons feel small, hero image cropped, etc."></textarea>
                        </label>
                        <button type="submit">Send mobile feedback</button>
                        <p class="form-success" data-message="Mobile feedback sent - thanks!"></p>
                    </form>
                </div>
            `;

            content.innerHTML += taskForms;

            document.querySelectorAll('.task-form input[name="customerEmail"]').forEach(input => {
                input.value = account.email;
            });

            const progressBarFill = document.getElementById('websiteProgressFill');
            const buildProgressPercentEl = document.getElementById('buildProgressPercent');
            const websiteProgressLabelEl = document.getElementById('websiteProgressLabel');
            const websiteStatusLabelEl = document.getElementById('websiteStatusLabel');
            const buildStatusTextEl = document.getElementById('buildStatusText');
            const totalChecklistItems = (website.checklist || []).length;
            const defaultStatus = website.status || 'In design queue';
            let baseProgress = Math.max(0, Number(website.progress || 0));

            function recalculateProgress() {
                if (!totalChecklistItems) {
                    if (progressBarFill) progressBarFill.style.width = `${baseProgress}%`;
                    if (buildProgressPercentEl) buildProgressPercentEl.textContent = `${baseProgress}%`;
                    if (websiteProgressLabelEl) websiteProgressLabelEl.textContent = `${baseProgress}%`;
                    if (websiteStatusLabelEl) websiteStatusLabelEl.textContent = defaultStatus;
                    if (buildStatusTextEl) buildStatusTextEl.textContent = defaultStatus;
                    return;
                }

                let completedCount = 0;
                let inProgressCount = 0;

                (website.checklist || []).forEach(item => {
                    const fallback = item.status ? 'complete' : 'pending';
                    const state = storedChecklistState[item.id] || fallback;
                    if (state === 'complete') {
                        completedCount += 1;
                    } else if (state === 'in-progress') {
                        inProgressCount += 1;
                    }
                });

                const derivedProgress = Math.round(((completedCount + inProgressCount * 0.5) / totalChecklistItems) * 100);
                const combinedProgress = Math.min(100, Math.max(baseProgress, derivedProgress));

                if (progressBarFill) {
                    progressBarFill.style.width = `${combinedProgress}%`;
                }
                if (buildProgressPercentEl) {
                    buildProgressPercentEl.textContent = `${combinedProgress}%`;
                }
                if (websiteProgressLabelEl) {
                    websiteProgressLabelEl.textContent = `${combinedProgress}%`;
                }

                let statusCopy = defaultStatus;
                if (completedCount >= totalChecklistItems) {
                    statusCopy = 'Launch ready';
                } else if (completedCount > 0 || inProgressCount > 0) {
                    statusCopy = 'In production';
                }

                if (websiteStatusLabelEl) {
                    websiteStatusLabelEl.textContent = statusCopy;
                }
                if (buildStatusTextEl) {
                    buildStatusTextEl.textContent = statusCopy;
                }
            }

            function setChecklistState(taskId, newState) {
                if (!taskId) return;
                storedChecklistState[taskId] = newState;
                localStorage.setItem(checklistStateKey, JSON.stringify(storedChecklistState));
                updateChecklistUI();
            }

            function updateChecklistUI() {
                document.querySelectorAll('.checklist-item').forEach(link => {
                    const taskId = link.dataset.taskId;
                    const fallback = link.classList.contains('complete') ? 'complete' : 'pending';
                    const state = storedChecklistState[taskId] || fallback;
                    link.classList.remove('state-pending', 'state-in-progress', 'state-complete');
                    link.classList.add(`state-${state}`);
                    const statusSpan = link.querySelector('.item-status');
                    if (statusSpan) {
                        statusSpan.textContent = state === 'complete' ? 'Completed' : state === 'in-progress' ? 'In progress' : 'Not started';
                    }
                    if (!storedChecklistState[taskId] && link.classList.contains('complete')) {
                        storedChecklistState[taskId] = 'complete';
                    }
                });
                localStorage.setItem(checklistStateKey, JSON.stringify(storedChecklistState));
                recalculateProgress();
            }

            document.querySelectorAll('.checklist-item').forEach(link => {
                const taskId = link.dataset.taskId;
                link.addEventListener('click', () => {
                    if (storedChecklistState[taskId] !== 'complete') {
                        setChecklistState(taskId, 'in-progress');
                    }
                });
            });

            document.querySelectorAll('.mark-progress').forEach(button => {
                button.addEventListener('click', () => {
                    const taskId = button.dataset.taskId;
                    const nextState = button.dataset.state || 'in-progress';
                    if (taskId) {
                        setChecklistState(taskId, nextState);
                    }
                });
            });

            document.querySelectorAll('.mark-complete').forEach(button => {
                button.addEventListener('click', () => {
                    const taskId = button.dataset.taskId;
                    if (taskId) {
                        setChecklistState(taskId, 'complete');
                    }
                });
            });

            document.querySelectorAll('.resource-list a').forEach(link => {
                const href = link.getAttribute('href');
                if (href && href.startsWith('#')) {
                    link.addEventListener('click', (event) => {
                        event.preventDefault();
                        const target = document.querySelector(href);
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            setTimeout(() => {
                                target.classList.add('highlight-pulse');
                                setTimeout(() => target.classList.remove('highlight-pulse'), 1600);
                            }, 150);
                        }
                    });
                }
            });

            function initScheduler(accountEmail) {
                const shell = document.querySelector('.scheduler-shell');
                if (!shell) return;

                const config = {
                    windowDays: 30,
                    slotsByWeekday: {
                        1: ['9:00 AM', '1:00 PM', '3:30 PM'],
                        2: ['10:00 AM', '2:30 PM'],
                        3: ['9:30 AM', '12:30 PM', '4:00 PM'],
                        4: ['11:00 AM', '2:00 PM'],
                        5: ['10:30 AM', '1:30 PM']
                    },
                    blackoutDates: []
                };

                const calendarGrid = shell.querySelector('[data-calendar-grid]');
                const monthLabel = shell.querySelector('[data-calendar-month]');
                const prevBtn = shell.querySelector('[data-calendar-prev]');
                const nextBtn = shell.querySelector('[data-calendar-next]');
                const slotSummary = shell.querySelector('[data-slot-summary]');
                const slotList = shell.querySelector('[data-slot-list]');
                const confirmBtn = shell.querySelector('[data-slot-confirm]');
                const scheduleForm = shell.querySelector('#scheduleRequestForm');
                const dateInput = shell.querySelector('#scheduledDateInput');
                const timeInput = shell.querySelector('#scheduledTimeInput');
                const successMessage = shell.querySelector('#scheduleSuccessMessage');

                if (!calendarGrid || !monthLabel || !slotSummary || !slotList || !confirmBtn || !scheduleForm) {
                    return;
                }

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const maxDate = new Date(today);
                maxDate.setDate(maxDate.getDate() + config.windowDays);
                const minMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                let focusDate = new Date(minMonth);
                let selectedDate = null;
                let selectedTime = null;

                const isBlackout = (dateObj) => config.blackoutDates.some((entry) => {
                    const blackout = new Date(entry);
                    blackout.setHours(0, 0, 0, 0);
                    return blackout.getTime() === dateObj.getTime();
                });

                const isWithinWindow = (dateObj) => dateObj >= today && dateObj <= maxDate;

                const formatDateLabel = (dateObj) => dateObj.toLocaleDateString(undefined, {
                    weekday: 'long',
                    month: 'short',
                    day: 'numeric'
                });

                const updateConfirmButton = () => {
                    if (selectedDate && selectedTime) {
                        confirmBtn.disabled = false;
                        confirmBtn.textContent = `Confirm ${selectedTime}`;
                        dateInput.value = selectedDate.toISOString();
                        timeInput.value = selectedTime;
                    } else if (selectedDate) {
                        confirmBtn.disabled = true;
                        confirmBtn.textContent = 'Choose a time';
                        dateInput.value = selectedDate.toISOString();
                        timeInput.value = '';
                    } else {
                        confirmBtn.disabled = true;
                        confirmBtn.textContent = 'Confirm selected time';
                        dateInput.value = '';
                        timeInput.value = '';
                    }
                    if (successMessage) {
                        successMessage.style.display = 'none';
                    }
                };

                const renderSlots = (availableSlots, dateObj) => {
                    slotList.innerHTML = '';

                    if (!dateObj) {
                        slotSummary.textContent = 'Select a day to view openings.';
                        updateConfirmButton();
                        return;
                    }

                    if (!availableSlots.length) {
                        slotSummary.textContent = `${formatDateLabel(dateObj)} ‚Ä¢ no openings available`;
                        updateConfirmButton();
                        return;
                    }

                    slotSummary.textContent = `${formatDateLabel(dateObj)} ‚Ä¢ ${availableSlots.length} opening${availableSlots.length > 1 ? 's' : ''}`;

                    availableSlots.forEach((timeLabel) => {
                        const slotBtn = document.createElement('button');
                        slotBtn.type = 'button';
                        slotBtn.className = 'slot-chip';
                        slotBtn.textContent = timeLabel;
                        if (selectedTime === timeLabel) {
                            slotBtn.classList.add('selected');
                        }
                        slotBtn.addEventListener('click', () => {
                            selectedTime = timeLabel;
                            slotList.querySelectorAll('.slot-chip').forEach((btn) => btn.classList.remove('selected'));
                            slotBtn.classList.add('selected');
                            updateConfirmButton();
                            setChecklistState('book-kickoff', 'in-progress');
                        });
                        slotList.appendChild(slotBtn);
                    });

                    updateConfirmButton();
                };

                const updateNavButtons = () => {
                    const focusMonthStart = new Date(focusDate.getFullYear(), focusDate.getMonth(), 1);
                    const maxMonth = new Date(maxDate.getFullYear(), maxDate.getMonth(), 1);
                    if (prevBtn) {
                        prevBtn.disabled = focusMonthStart.getTime() <= minMonth.getTime();
                    }
                    if (nextBtn) {
                        nextBtn.disabled = focusMonthStart.getTime() >= maxMonth.getTime();
                    }
                };

                const renderCalendar = () => {
                    calendarGrid.innerHTML = '';
                    monthLabel.textContent = focusDate.toLocaleString(undefined, { month: 'long', year: 'numeric' });

                    const firstWeekday = new Date(focusDate.getFullYear(), focusDate.getMonth(), 1).getDay();
                    const daysInMonth = new Date(focusDate.getFullYear(), focusDate.getMonth() + 1, 0).getDate();
                    const totalCells = Math.ceil((firstWeekday + daysInMonth) / 7) * 7;

                    let dayCounter = 1;
                    for (let cellIndex = 0; cellIndex < totalCells; cellIndex++) {
                        if (cellIndex < firstWeekday || dayCounter > daysInMonth) {
                            const spacer = document.createElement('div');
                            spacer.className = 'calendar-day placeholder';
                            calendarGrid.appendChild(spacer);
                            continue;
                        }

                        const dateObj = new Date(focusDate.getFullYear(), focusDate.getMonth(), dayCounter);
                        const weekday = dateObj.getDay();
                        const slots = config.slotsByWeekday[weekday] || [];
                        const dayBtn = document.createElement('button');
                        dayBtn.type = 'button';
                        dayBtn.className = 'calendar-day';

                        const numberSpan = document.createElement('span');
                        numberSpan.className = 'day-number';
                        numberSpan.textContent = dayCounter;
                        dayBtn.appendChild(numberSpan);

                        const dotSpan = document.createElement('span');
                        dotSpan.className = 'day-dot';
                        dayBtn.appendChild(dotSpan);

                        if (!slots.length || !isWithinWindow(dateObj) || isBlackout(dateObj)) {
                            dayBtn.classList.add('unavailable');
                            dayBtn.disabled = true;
                            dotSpan.remove();
                        } else {
                            dayBtn.classList.add('available');
                            dayBtn.addEventListener('click', () => {
                                selectedDate = new Date(dateObj);
                                selectedTime = null;
                                renderCalendar();
                                renderSlots(slots, dateObj);
                                setChecklistState('book-kickoff', 'in-progress');
                            });
                        }

                        if (selectedDate && dateObj.toDateString() === selectedDate.toDateString()) {
                            dayBtn.classList.add('selected');
                        }

                        calendarGrid.appendChild(dayBtn);
                        dayCounter += 1;
                    }

                    updateNavButtons();
                };

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        if (prevBtn.disabled) return;
                        focusDate = new Date(focusDate.getFullYear(), focusDate.getMonth() - 1, 1);
                        renderCalendar();
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        if (nextBtn.disabled) return;
                        focusDate = new Date(focusDate.getFullYear(), focusDate.getMonth() + 1, 1);
                        renderCalendar();
                    });
                }

                scheduleForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    if (!selectedDate || !selectedTime) {
                        slotSummary.textContent = 'Choose a day and time before confirming.';
                        return;
                    }

                    confirmBtn.disabled = true;
                    const originalLabel = confirmBtn.textContent;
                    confirmBtn.textContent = 'Sending...';
                    if (successMessage) {
                        successMessage.style.display = 'none';
                    }

                    const formData = new FormData(scheduleForm);
                    formData.set('customerEmail', accountEmail);
                    formData.set('scheduledDate', selectedDate.toISOString());
                    formData.set('scheduledTime', selectedTime);

                    try {
                        const response = await fetch(scheduleForm.action, {
                            method: 'POST',
                            body: formData,
                            headers: {
                                Accept: 'application/json'
                            }
                        });

                        if (!response.ok) {
                            throw new Error('Failed to send scheduling request.');
                        }

                        confirmBtn.textContent = 'Request sent!';
                        if (successMessage) {
                            successMessage.textContent = successMessage.dataset.message || 'Kickoff slot received! We‚Äôll confirm shortly.';
                            successMessage.style.display = 'block';
                        }
                        setChecklistState('book-kickoff', 'complete');
                        updateConfirmButton();
                        setTimeout(() => {
                            confirmBtn.textContent = originalLabel;
                        }, 2500);
                    } catch (error) {
                        confirmBtn.disabled = false;
                        confirmBtn.textContent = originalLabel;
                        if (successMessage) {
                            successMessage.textContent = 'Could not send request. Please email 145brice@gmail.com.';
                            successMessage.style.display = 'block';
                        }
                        console.error('Scheduling request failed:', error);
                    }
                });

                renderCalendar();
                renderSlots([], null);
                updateConfirmButton();
            }

            initScheduler(account.email);

            updateChecklistUI();

            // Onboarding tasks with local storage persistence
            const tasks = (onboarding?.tasks || []);
            const taskStateKey = `dashboardTasks:${account.email}`;
            const storedTaskState = JSON.parse(localStorage.getItem(taskStateKey) || '{}');
            const normalizedTasks = tasks.map(task => ({
                ...task,
                completed: Object.prototype.hasOwnProperty.call(storedTaskState, task.id)
                    ? storedTaskState[task.id]
                    : !!task.completed,
            }));

            const taskListEl = document.getElementById('taskList');
            if (taskListEl) {
                if (!normalizedTasks.length) {
                    taskListEl.innerHTML = '<li class="muted">No onboarding tasks at the moment.</li>';
                } else {
                    taskListEl.innerHTML = normalizedTasks.map(task => `
                        <li class="task-item ${task.completed ? 'done' : ''}">
                            <input type="checkbox" class="task-checkbox" data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>
                            <div class="task-content">
                                <strong>${task.title}</strong>
                                <span>${task.description}</span>
                            </div>
                            <span class="tag">${task.category}</span>
                        </li>
                    `).join('');
                }
            }

            const taskProgressFill = document.getElementById('taskProgressFill');
            const taskProgressPercent = document.getElementById('taskProgressPercent');
            const taskProgressValue = document.getElementById('taskProgressValue');

            function updateTaskProgress() {
                const total = normalizedTasks.length;
                const completedCount = normalizedTasks.filter(task => task.completed).length;
                const percent = total ? Math.round((completedCount / total) * 100) : 0;

                if (taskProgressFill) {
                    taskProgressFill.style.width = `${percent}%`;
                }
                if (taskProgressPercent) {
                    taskProgressPercent.textContent = `${percent}%`;
                }
                if (taskProgressValue) {
                    taskProgressValue.textContent = `${completedCount} of ${total} tasks complete`;
                }
            }

            if (taskListEl && normalizedTasks.length) {
                taskListEl.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const taskId = checkbox.dataset.taskId;
                        const task = normalizedTasks.find(item => item.id === taskId);
                        if (!task) return;

                        task.completed = checkbox.checked;
                        storedTaskState[taskId] = checkbox.checked;
                        localStorage.setItem(taskStateKey, JSON.stringify(storedTaskState));
                        checkbox.closest('.task-item').classList.toggle('done', checkbox.checked);
                        updateTaskProgress();
                    });
                });
            }

            updateTaskProgress();

            const activityListEl = document.getElementById('activityList');
            if (activityListEl && !activityMarkup) {
                activityListEl.innerHTML = '<li class="muted">No activity yet.</li>';
            }

            const resourceListEl = document.getElementById('resourceList');
            if (resourceListEl && !resourcesMarkup) {
                resourceListEl.innerHTML = '<li class="muted">Resources coming soon.</li>';
            }

            // Handle task forms submission -> mark checklist complete
            document.querySelectorAll('.task-form').forEach(form => {
                const taskId = form.getAttribute('data-task-id');
                form.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    const submitButton = form.querySelector('button');
                    const originalText = submitButton.textContent;
                    const successMessage = form.querySelector('.form-success');
                    submitButton.disabled = true;
                    submitButton.textContent = 'Sending...';
                    if (successMessage) {
                        successMessage.style.display = 'none';
                    }

                    const formData = new FormData(form);

                    try {
                        const response = await fetch(form.action, {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json'
                            },
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Failed to submit form');
                        }

                        if (taskId) {
                            setChecklistState(taskId, 'complete');
                        }

                        submitButton.textContent = 'Sent!';
                        form.reset();
                        const hiddenEmail = form.querySelector('input[name="customerEmail"]');
                        if (hiddenEmail) {
                            hiddenEmail.value = account.email;
                        }
                        if (successMessage) {
                            successMessage.textContent = successMessage.dataset.message || 'Thanks! We got it.';
                            successMessage.style.display = 'block';
                        }
                        setTimeout(() => {
                            submitButton.textContent = originalText;
                            submitButton.disabled = false;
                        }, 2000);
                    } catch (error) {
                        console.error('Task form submission failed:', error);
                        submitButton.textContent = 'Try again';
                        submitButton.disabled = false;
                        if (successMessage) {
                            successMessage.style.display = 'none';
                        }
                    }
                });
            });
        }

        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.clear();
            window.location.href = '/login.html';
        });

        loadDashboard();
    </script>
</body>
</html>
